https://www.planttext.com/

@startuml
title Dialog Extraction (Monolith -> Dialog Service)

skinparam componentStyle rectangle
skinparam shadowing false

actor Client

package "Docker Compose Network" {
  [Monolith (Facade)\n:8080] as MONO
  [Dialog-Service\n:8081] as Dialog
}

database "In-Memory/DB\n(users)" as UDB
database "In-Memory/DB\n(messages)" as MDB

Client -[#blue]> MONO : HTTP (Legacy API)\nGET/POST /dialog/*
MONO -[#green]> Dialog : HTTP (internal)\n/x-user-id, x-request-id
MONO -[#brown]> UDB : Users
Dialog -[#brown]> MDB : Dialog messages

note right of MONO
- Валидирует Bearer
- Прокидывает x-request-id (генерит при отсутствии)
- Делегирует диалоги в Dialog-Service
end note

note right of Dialog
- Хранит сообщения
- Доверяет x-user-id от монолита
- Возвращает x-request-id
end note

@enduml
